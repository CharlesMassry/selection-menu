<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>JavaScript context menu on selection by iDoRecall</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="index.css" media="screen">
  </head>
  <body>

    <script src="../selection-menu.js"></script>

    <script>
    window.addEventListener('load', function () {

      new SelectionMenu({
        container: document.getElementsByClassName('main-content')[0],
        id: 'selection-menu',
        menuHTML: document.querySelector('#mymenu').innerHTML,
        onselect: function (e) {
          var truncatedText = this.selectedText.replace(/\s+/g, ' ');
          if (truncatedText.length > 30)
            truncatedText = truncatedText.slice(0, 30) + '...';

          this.menuHTML = this.menuHTML.replace(/ search for .*/g, ' search for <i>' + truncatedText + '</i></a>');
        },
        handler: function (e) {
          var target = e.target || e.srcElement,
            id = target.id,
            selectedText = this.selectedText,
            query = encodeURI(selectedText.replace(/\s/g, '+')),
            searchURI;

          if (id == 'selection-menu-google') {
            searchURI = 'http://www.google.com/search?q=';
          } else if (id == 'selection-menu-bing') {
            searchURI = 'http://www.bing.com/search?q=';
          }

          location.href = searchURI + query;
        }
      });

    });
    </script>
    </head>
    <body>

    <div id="mymenu" hidden>
    <a id="selection-menu-google">Google search for foo</a>
    <a id="selection-menu-bing">Bing search for foo</a>
    </div>


    <section class="page-header">
      <h1 class="project-name">JavaScript context menu on selection</h1>
      <h2 class="project-tagline">Automatically pop over a context menu when the user selects text</h2>
      <a href="https://github.com/iDoRecall/selectionmenu" class="btn">View on GitHub</a>
      <a href="https://github.com/iDoRecall/selectionmenu/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/iDoRecall/selectionmenu/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="selectionmenu" class="anchor" href="#selectionmenu" aria-hidden="true"><span class="octicon octicon-link"></span></a>SelectionMenu</h1>

<p>SelectionMenu is a small, self-contained, framework-agnostic JavaScript module that displays a custom context menu when the user selects text on the page.</p>

<p>This menu may offer a search feature, dictionary lookup, post to Facebook or similar.</p>

<h2>
<a id="history" class="anchor" href="#history" aria-hidden="true"><span class="octicon octicon-link"></span></a>History</h2>

<p>The motivation for creating this module was having a sleek contextual selection mechanism in the Chrome extension for <a href="http://idorecall.com">iDoRecall</a>. </p>

<p>This module is largely my fork of <a href="https://github.com.molily">Mathias Sch√§fer</a>'s work from 2011, brought up to date with modern browsers (Chrome, Firefox, Safari, Opera, IE9+) and the AMD module pattern. <a href="https://github.com/xdamman/">Xavier Damman</a>'s <a href="https://github.com/xdamman/selection-sharer">selection-sharer</a> was another influence (detecting the forward vs. backward selection direction).</p>

<p>The idea and the implementation originally resemble the selection context menu on nytimes.com, but the script is way simpler and easier to integrate. </p>

<p>The script uses the <a href="http://www.w3.org/TR/DOM-Level-2-Traversal-Range/ranges.html">W3C DOM Range</a>, which is available in modern browsers: IE9+, Chrome, Firefox, Safari, Opera.</p>

<h2>
<a id="features-and-differences-from-the-original" class="anchor" href="#features-and-differences-from-the-original" aria-hidden="true"><span class="octicon octicon-link"></span></a>Features and differences from the original</h2>

<ul>
<li>Display the context menu near where the mouse button was released (the original always displayed the menu at the end of the selection, and selection-sharer displays it <a href="https://github.com/xdamman/selection-sharer/issues/18">asymmetrically</a> and <a href="https://github.com/xdamman/selection-sharer/issues/17">always at the top of the selection</a>)
</li>
<li>Pass any HTML for the context menu, and style it as you want via its id</li>
<li>Keyboard events are not handled, so that if the user wants to make fine adjustments to the selection with Shift+arrows, the menu will remain near the mouse cursor</li>
<li>The menu text is made unselectable (fixes a number of <a href="https://github.com/molily/selectionmenu/issues/5">bugs in the original library</a>)</li>
<li>Supports minimum and maximum selection length (<a href="https://github.com/xdamman/selection-sharer/issues/13">selection-sharer #10</a>)</li>
<li>Clicking outside the popover <em>always</em> closes the menu (fixes <a href="https://github.com/xdamman/selection-sharer/issues/11">selection-sharer #11</a>)</li>
<li>
<code>onselect</code> event</li>
<li>Dynamic menu depending on the content of the selection</li>
</ul>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>Create an instance of SelectionMenu by calling <code>new SelectionMenu</code>.</p>

<p>Pass an object literal with the following options:</p>

<ul>
<li>
<code>container</code> (DOM element): The element where the copy event is observed. Normally that's the main text container.</li>
<li>
<code>menuHTML</code> (string): A string of HTML for the menu e.g. a list of links.</li>
<li>
<code>handler</code> (function): A handler function which is called when the user clicks on the menu. Use the passed click event to access the click link and respond to the user's action.</li>
<li>
<code>minlength</code> (number, optional): Only display the menu if the selected text has at least this length. Defaults to 5 characters.</li>
<li>
<code>maxlength</code> (number, optional): Only display the menu if the selected text is at most this long. Defaults to <code>Infinity</code>.</li>
<li>
<code>id</code> (string, optional): The ID of the menu element which is inserted. Defaults to <code>selection-menu</code>.</li>
<li>
<p><code>onselect</code> (function, optional): Custom event generated when the mouse selection changes. Not generated when the selection is changed via the keyboard. Use it to customize the menu dynamically based on the contents of the selection:</p>

<div class="highlight highlight-js"><pre><span class="pl-k">new</span> <span class="pl-en">SelectionMenu</span>({
  ...
  <span class="pl-en">onselect</span>: <span class="pl-k">function</span> (<span class="pl-smi">e</span>) {
    <span class="pl-v">this</span>.menuHTML <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Selection length: <span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-v">this</span>.selectedText.<span class="pl-c1">length</span>;
  }
});</pre></div>
</li>
</ul>

<h2>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h2>

<p>This observes mouseup events on the element with the ID <code>article</code>. It inserts a menu
with two links which both have IDs to recognize them. In the handler function, the
selected text is read. Depending on the clicked link, the selected text is
looked up on Google or Bing.</p>

<div class="highlight highlight-js"><pre><span class="pl-k">new</span> <span class="pl-en">SelectionMenu</span>({
  container<span class="pl-k">:</span> <span class="pl-c1">document</span>.<span class="pl-c1">getElementById</span>(<span class="pl-s"><span class="pl-pds">'</span>article<span class="pl-pds">'</span></span>),
  menuHTML<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>&lt;a id="selection-menu-google"&gt;Google Search&lt;/a&gt;&lt;a id="selection-menu-bing"&gt;Bing Search&lt;/a&gt;<span class="pl-pds">'</span></span>,
  <span class="pl-en">handler</span>: <span class="pl-k">function</span> (<span class="pl-smi">e</span>) {
    <span class="pl-k">var</span> target <span class="pl-k">=</span> e.<span class="pl-c1">target</span>,
      id <span class="pl-k">=</span> target.<span class="pl-c1">id</span>,
      selectedText <span class="pl-k">=</span> <span class="pl-v">this</span>.selectedText,
      query <span class="pl-k">=</span> encodeURI(selectedText.<span class="pl-c1">replace</span>(<span class="pl-sr"><span class="pl-pds">/</span><span class="pl-c1">\s</span><span class="pl-pds">/</span>g</span>, <span class="pl-s"><span class="pl-pds">'</span>+<span class="pl-pds">'</span></span>)),
      searchURI;

    <span class="pl-k">if</span> (id <span class="pl-k">===</span> <span class="pl-s"><span class="pl-pds">'</span>selection-menu-google<span class="pl-pds">'</span></span>) {
      searchURI <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>http://www.google.com/search?ie=utf-8&amp;q=<span class="pl-pds">'</span></span>;
    } <span class="pl-k">else</span> <span class="pl-k">if</span> (id <span class="pl-k">===</span> <span class="pl-s"><span class="pl-pds">'</span>selection-menu-bing<span class="pl-pds">'</span></span>) {
      searchURI <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>http://www.bing.com/search?q=<span class="pl-pds">'</span></span>;
    }

    location.<span class="pl-c1">href</span> <span class="pl-k">=</span> searchURI <span class="pl-k">+</span> query;
  }
});</pre></div>

<p>To define menus more flexibly, use a hidden <code>&lt;div&gt;</code> in your HTML, and pass its <code>innerHTML</code> to SelectionMenu:</p>

<div class="highlight highlight-html"><pre>&lt;<span class="pl-ent">div</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>mymenu<span class="pl-pds">"</span></span> <span class="pl-e">hidden</span>&gt;
  &lt;<span class="pl-ent">ul</span>&gt;
    &lt;<span class="pl-ent">li</span>&gt;Option one
    &lt;<span class="pl-ent">li</span>&gt;Option two
  &lt;/<span class="pl-ent">ul</span>&gt;  
&lt;/<span class="pl-ent">div</span>&gt;</pre></div>

<div class="highlight highlight-js"><pre><span class="pl-k">new</span> <span class="pl-en">SelectionMenu</span>({
  container<span class="pl-k">:</span> <span class="pl-c1">document</span>.<span class="pl-c1">getElementById</span>(<span class="pl-s"><span class="pl-pds">'</span>article<span class="pl-pds">'</span></span>),
  menuHTML<span class="pl-k">:</span> <span class="pl-c1">document</span>.<span class="pl-c1">getElementById</span>(<span class="pl-s"><span class="pl-pds">'</span>mymenu<span class="pl-pds">'</span></span>).innerHTML,
  <span class="pl-en">handler</span>: <span class="pl-k">function</span> (<span class="pl-smi">e</span>) {
    ...
  }
});</pre></div>

<h2>
<a id="upcoming-features" class="anchor" href="#upcoming-features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Upcoming features</h2>

<ul>
<li>automatically position menu to preserve width if created near the right border of the container, and not go off screen if the selection is made near the very top</li>
</ul>

<h2>
<a id="license-and-copyright" class="anchor" href="#license-and-copyright" aria-hidden="true"><span class="octicon octicon-link"></span></a>License and copyright</h2>

<p>Maintainer: Dan Dascalescu (<a href="https://github.com/dandv">@dandv</a>)</p>

<p>Copyright (C) 2015 <a href="http://idorecall.com">iDoRecall</a>, Inc.</p>

<p>The MIT License (MIT)</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/iDoRecall/selectionmenu">JavaScript context menu on selection</a> is maintained by <a href="https://github.com/iDoRecall">iDoRecall</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>


  </body>
</html>
